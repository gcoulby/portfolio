1:HL["/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/css/6fbf3aaf3cef8a6d.css",{"as":"style"}]
3:HL["/_next/static/css/017368e0e2994f4b.css",{"as":"style"}]
0:[[["",{"children":["portfolio",{"children":[["slug","virtual-smart-office","d"],{"children":["__PAGE__?{\"slug\":\"virtual-smart-office\"}",{}]}]}]},"$undefined","$undefined",true],"$L4",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/6fbf3aaf3cef8a6d.css","precedence":"next"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/017368e0e2994f4b.css","precedence":"next"}]],["$L5",["$","meta",null,{"name":"next-size-adjust"}]]]]]
6:I{"id":"4463","chunks":["272:static/chunks/webpack-fdae4180b4c832f2.js","253:static/chunks/bce60fc1-f330208a48f279d5.js","488:static/chunks/488-91a7cb7a32fe40e5.js"],"name":"","async":false}
7:I{"id":"1010","chunks":["272:static/chunks/webpack-fdae4180b4c832f2.js","253:static/chunks/bce60fc1-f330208a48f279d5.js","488:static/chunks/488-91a7cb7a32fe40e5.js"],"name":"","async":false}
8:I{"id":"8164","chunks":["296:static/chunks/2e3a737e-a0de5975afcca45a.js","920:static/chunks/920-9b6e70f29bd7ba21.js","849:static/chunks/app/portfolio/[slug]/page-8d15c40e0a7dcc11.js"],"name":"","async":false}
4:[["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__className_a64ecd","children":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","portfolio","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","portfolio","children",["slug","virtual-smart-office","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":[["$","div",null,{"children":["$","div",null,{"className":"modular","children":[["$","$L8",null,{"keyWords":[],"showTags":false}],["$","section",null,{"className":"resume-section","id":"o","children":["$","div",null,{"className":"resume-section-content","children":[["$","h3",null,{"className":"text-dark","children":"Virtual Smart Office"}],["$","p",null,{"children":"An AI enabled, demonstration of principal Internet of Things (IoT) technologies (e.g., MQTT brokers, timeseries databases, real-time data capture) built on a real-time, cloud-based, microservice architecture."}],["$","article",null,{"className":"prose","children":["$","div","outer",{"children":[["$","p","0",{"className":"$undefined","children":["The Virtual Smart Office is a simulated environment to showcase Internet of Things principals and technologies."]}],["$","p","1",{"className":"$undefined","children":["The simulator is built using microservice architecture running on Docker, through a docker-compose stack. The stack offers a one-stop-shop to deliver a series of microservices that demonstrate a range of IoT technologies, including:"]}],["$","ul","2",{"start":"$undefined","className":"$undefined","children":[["$","li","0",{"className":"$undefined","children":["MQTT"]}],["$","li","1",{"className":"$undefined","children":["Timeseries Databases"]}],["$","li","2",{"className":"$undefined","children":["Real-time data capture"]}],["$","li","3",{"className":"$undefined","children":["AI"]}],["$","li","4",{"className":"$undefined","children":["Cloud"]}],["$","li","5",{"className":"$undefined","children":["Microservices"]}],["$","li","6",{"className":"$undefined","children":["Front-end visualisation"]}],["$","li","7",{"className":"$undefined","children":["APIs and RESTful services"]}]]}],["$","p","3",{"className":"$undefined","children":["The following diagram shows the architecture of the Virtual Smart Office:"]}],["$","p","4",{"className":"$undefined","children":[["$","img","0",{"alt":"screenshot","title":"$undefined","src":"/project-images/virtual-smart-office/architecture.png","className":"$undefined"}]]}],["$","h3","5",{"id":"client-application","className":"$undefined","children":["Client Application"]}],["$","p","6",{"className":"$undefined","children":["The purpose of the client application is to provide a dashboard and ‘front-end’ to the Virtual Smart Office. The front-end of the application is developed using ReactJS with TypeScript and is deployed using Docker and docker-compose. The docker-compose file is configured to build the application using the following command:"]}],["$","pre","7",{"className":"$undefined","children":["$","code",null,{"className":"lang-yml","children":"version: \"3\"\n\nservices:\n  client:\n    container_name: virtual-smart-office-client\n    hostname: virtual-smart-office-client.local\n    build: ./client/\n    restart: unless-stopped\n    ports:\n      - 40153:3000\n    networks:\n      - virtual-smart-office\n    environment:\n      - REACT_APP_MOBILE=false\n      - REACT_APP_MQTT_HOST=${MQTT_HOST}\n      - REACT_APP_MQTT_PORT=${MQTT_PORT}\n      - REACT_APP_MQTT_USER=${MQTT_USERNAME}\n      - REACT_APP_MQTT_PASSWORD=${MQTT_PASSWORD}\n  controller:\n    container_name: virtual-smart-office-controller\n    hostname: virtual-smart-office-controller.local\n    build: ./client/\n    restart: unless-stopped\n    ports:\n      - 40154:3000\n    networks:\n      - virtual-smart-office\n    environment:\n      - REACT_APP_MOBILE=true\n      - REACT_APP_MQTT_HOST=${MQTT_HOST}\n      - REACT_APP_MQTT_PORT=${MQTT_PORT}\n      - REACT_APP_MQTT_USER=${MQTT_USERNAME}\n      - REACT_APP_MQTT_PASSWORD=${MQTT_PASSWORD}\n  mosquitto:\n    container_name: mqtt\n    image: eclipse-mosquitto\n    restart: always\n    networks:\n      virtual-smart-office:\n        ipv4_address: 172.20.0.4\n    volumes:\n      - ./data/mqtt/config:/mosquitto/config\n      - ./data/mqtt/data:/mosquitto/data\n      - ./data/mqtt/log:/mosquitto/log\n    ports:\n      - 40155:9001\nnetworks:\n  virtual-smart-office:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.0.0/24"}]}],["$","p","8",{"className":"$undefined","children":["The docker-compose file builds two instances of the client application, one for the main application and one for the mobile application. The main application is accessible via the following URL: ",["$","a","4",{"href":"https://iot-sim.grahamcoulby.co.uk/","title":"$undefined","className":"$undefined","children":["https://iot-sim.grahamcoulby.co.uk/"]}],". The mobile application is accessible via the following URL: ",["$","a","7",{"href":"https://iot-sim-controller.grahamcoulby.co.uk/","title":"$undefined","className":"$undefined","children":["https://iot-sim-controller.grahamcoulby.co.uk/"]}],"."]}],["$","p","9",{"className":"$undefined","children":["The Dockerfile for the React application is as follows:"]}],["$","pre","10",{"className":"$undefined","children":["$","code",null,{"className":"lang-docker","children":"FROM node:16.14.0-alpine\n\nWORKDIR /app\n\n# add `/app/node_modules/.bin` to $PATH\nENV PATH /app/node_modules/.bin:$PATH\n\n\n# install app dependencies\nCOPY package.json ./\n# COPY package-lock.json ./\nRUN npm install\nRUN npm install react-scripts@3.4.1 -g\n\n# add app\nCOPY . ./\n\n# start app\nCMD [\"npm\", \"start\"]"}]}],["$","p","11",{"className":"$undefined","children":[["$","img","0",{"alt":"screenshot","title":"$undefined","src":"/project-images/virtual-smart-office/feature.png","className":"$undefined"}]]}],["$","h4","12",{"id":"svg-model","className":"$undefined","children":["SVG Model"]}],["$","p","13",{"className":"$undefined","children":["The application provides a graphical SVG model, which I got from FreePik during my Ph.D. I modified the SVG using Affinity Designer and added interactive elements that can be ‘turned on’ and ‘turned off’. These elements are:"]}],["$","ul","14",{"start":"$undefined","className":"$undefined","children":[["$","li","0",{"className":"$undefined","children":["Air Conditioners"]}],["$","li","1",{"className":"$undefined","children":["Air Purifiers"]}],["$","li","2",{"className":"$undefined","children":["Lights"]}]]}],["$","p","15",{"className":"$undefined","children":["The state of these elements is controlled by MQTT messages, which are published and subscribed to by the client application. The client application also publishes MQTT messages to control the state of these elements."]}],["$","p","16",{"className":"$undefined","children":[["$","img","0",{"alt":"screenshot","title":"$undefined","src":"/project-images/virtual-smart-office/5.png","className":"$undefined"}]]}],["$","h4","17",{"id":"mqtt-controls","className":"$undefined","children":["MQTT Controls"]}],["$","p","18",{"className":"$undefined","children":["The client also displays a series of toggle switches. These provide a real-time, multi-pub/sub interface, whereby multiple clients can publish and subscribe to the MQTT messages being transmitted/received from/to the client."]}],["$","blockquote","19",{"className":"$undefined","children":[["$","p","0",{"className":"$undefined","children":["The virtual Air Conditioners and Air Purifiers used in this simulation do not have an effect on the data generated in the graphs. Their only purpose is to simulate/showcase MQTT control over the building."]}]]}],["$","h4","20",{"id":"data-graphs","className":"$undefined","children":["Data Graphs"]}],["$","p","21",{"className":"$undefined","children":["The application also displays sensor telemetry from simulated IoT environmental quality sensors. The data from these ‘devices’ are generated by the ",["$","strong","1",{"className":"$undefined","children":[["$","code","0",{"className":"$undefined","children":"IEQ Simulator"}]]}]," service, which is explained below. The graph dashboard is embedded into this application and is generated using Grafana, which takes a data feed from InfluxDB."]}],["$","h4","22",{"id":"weather-rss","className":"$undefined","children":["Weather RSS"]}],["$","p","23",{"className":"$undefined","children":["The application also displays a weather RSS feed, which is pulled from BBC Weather. This is just to simulate fetching data from an external source."]}],["$","h4","24",{"id":"mobile-application","className":"$undefined","children":["Mobile Application"]}],["$","p","25",{"className":"$undefined","children":["There is a mobile application as well, which is accessible via the QR code on the client application (",["$","a","2",{"href":"https://iot-sim-controller.grahamcoulby.co.uk/","title":"$undefined","className":"$undefined","children":["https://iot-sim-controller.grahamcoulby.co.uk/"]}],"). The mobile application is actually the same React application, but with a different UI. The docker-compose file uses the same build command as the client application:"]}],["$","pre","26",{"className":"$undefined","children":["$","code",null,{"className":"lang-docker","children":"build: ./client/"}]}],["$","p","27",{"className":"$undefined","children":["However, the mobile application sets the following flag in the environment variables:"]}],["$","pre","28",{"className":"$undefined","children":["$","code",null,{"className":"lang-bash","children":"REACT_APP_MOBILE=true"}]}],["$","p","29",{"className":"$undefined","children":["When the React app sees this flag, it shows only the toggle switches and the connect buttons, this saved writing two separate implementations of the application - but also allows the main application to be scalable to different screen sizes - without limiting the functionality of the application."]}],["$","p","30",{"className":"$undefined","children":[["$","img","0",{"alt":"screenshot","title":"$undefined","src":"/project-images/virtual-smart-office/3.png","className":"$undefined"}]]}],["$","hr","31",{"className":"$undefined"}],["$","h3","32",{"id":"ieq-predictor-api","className":"$undefined","children":["IEQ Predictor API"]}],["$","p","33",{"className":"$undefined","children":["An IEQ predictor API was created to generate realistic 'fake' sensor data. The API was developed using the python FastAPI framework."]}],["$","p","34",{"className":"$undefined","children":["The Dockerfile for the API is as follows:"]}],["$","pre","35",{"className":"$undefined","children":["$","code",null,{"className":"lang-docker","children":"FROM python:3.10-slim\n\nRUN apt-get update\nRUN apt-get install -y gcc\nRUN apt-get install -y default-libmysqlclient-dev\nENV PYTHONBUFFERED 1\n\nCOPY . /app\nCOPY ./requirements.txt /app\n\nWORKDIR /app\n\nRUN pip3 install -r requirements.txt\n\nEXPOSE 8000\n\nCMD [\"uvicorn\", \"main:app\", \"--host=0.0.0.0\", \"--port=8000\", \"--reload\"]"}]}],["$","p","36",{"className":"$undefined","children":["The data are generated using an ",["$","strong","1",{"className":"$undefined","children":["Autoregressive Long Short Term Memory Neural Network,"]}]," which is trained on IEQ data captured from a previous study entitled “Personalised and Sustainable IEQ Monitoring: Use of Multi-Modal and Pervasive Technologies” (",["$","a","5",{"href":"https://doi.org/10.3390/ijerph20064897","title":"$undefined","className":"$undefined","children":["https://doi.org/10.3390/ijerph20064897"]}],"). The data were captured from a series of sensors placed in a physical study location. The data were captured over a period of 6 months, and the data were captured at 1-minute intervals. Data were captured from the following sensors:"]}],["$","ul","37",{"start":"$undefined","className":"$undefined","children":[["$","li","0",{"className":"$undefined","children":["CO2 Sensor"]}],["$","li","1",{"className":"$undefined","children":["eCO2 Sensor"]}],["$","li","2",{"className":"$undefined","children":["Temperature Sensor"]}],["$","li","3",{"className":"$undefined","children":["Humidity Sensor"]}],["$","li","4",{"className":"$undefined","children":["Light Sensor"]}],["$","li","5",{"className":"$undefined","children":["Sound Sensor"]}],["$","li","6",{"className":"$undefined","children":["Pressure Sensor"]}]]}],["$","p","38",{"className":"$undefined","children":["The LSTM model was trained to generate a new sensor reading for each of the sensors based on the previous 10 readings. The model was trained on 70% of the data, and the remaining 30% was used to validated and test the model. The model was trained using the Keras library, and the model was saved as a .h5 file. The model was then integrated into a FastAPI application, which provides data to the ",["$","strong","6",{"className":"$undefined","children":[["$","code","0",{"className":"$undefined","children":"IEQ Simulator"}]]}]," service. The documentation for the API can be found here: ",["$","a","9",{"href":"https://ieq-predict.grahamcoulby.co.uk/docs","title":"$undefined","className":"$undefined","children":["https://ieq-predict.grahamcoulby.co.uk/docs"]}]]}],["$","p","39",{"className":"$undefined","children":[["$","img","0",{"alt":"screenshot","title":"$undefined","src":"/project-images/virtual-smart-office/1.png","className":"$undefined"}]]}],["$","h3","40",{"id":"iot-simulator-service","className":"$undefined","children":["IoT Simulator Service"]}],["$","p","41",{"className":"$undefined","children":["The IoT Simulator service is a python application that generates simulated data from a series of IoT devices. The application calls the ",["$","strong","1",{"className":"$undefined","children":[["$","code","0",{"className":"$undefined","children":"IEQ Predictor"}]]}]," API to generate the data for the sensors. Since the ",["$","strong","3",{"className":"$undefined","children":[["$","code","0",{"className":"$undefined","children":"IEQ Predictor"}]]}]," service requires the previous 10 readings to generate a new reading, the IoT Simulator service creates the payload for the API by taking a sample from the original dataset used to train the model."]}],["$","p","42",{"className":"$undefined","children":["To create the data the following method is used:"]}],["$","pre","43",{"className":"$undefined","children":["$","code",null,{"className":"lang-python","children":"\ndef build_df(room, dayOffset=0):\n    \"\"\"Builds the df from the ImputationResult.csv file. This file contains\n    the imputed data from a previous study (https://doi.org/10.3390/ijerph20064897)\n    and is used to train the model. The df is built by reading the CSV file\n    and adjusting the timestamps to the current time. This is done by finding the\n    last record in the df with the same day, hour and minute as the current\n    timestamp. The df is then sliced from the start to the index of the last\n    record. The date is then shifted by the number of days between the last record\n    and the current timestamp. This creates a df that is simulating the current\n    historical data.\n    \"\"\"\n    global dfs\n    # Read in the CSV data\n    df = pd.read_csv(f\"{BASE_PATH}/ImputationResult.csv\")\n\n    df[\"dt\"] = pd.to_datetime(df.pop(\"dt\"), format=\"%Y-%m-%d %H:%M:%S\")\n\n    # Get current time\n    now = datetime.now(pytz.timezone(\"Europe/London\"))\n    hour = now.hour\n    minute = now.minute\n    weekday = now.weekday() + 1 - dayOffset\n    if weekday <= 0:\n        weekday = 7\n    elif weekday > 7:\n        weekday = 1\n\n    # Get the last index from the df where the Day, Hour and Minute\n    # match the current timestamp\n    idx = np.where(\n        df[\"DayNumber\"].eq(weekday) & df[\"Hour\"].eq(hour) & df[\"Minute\"].eq(minute + 1)\n    )[0][-1]\n\n    # Set the dateframe to a slice from start to the previously found index\n    df = df[:idx]\n\n    # find the datetime in the lastrow and use it to find the number of days\n    # that have passed between that datapoint and the current timestamp\n    lastRow = df.iloc[-1]\n    oldDateStr = f\"{lastRow['dt']} {lastRow['Hour']}:{lastRow['Minute']}\"\n    oldTimestamp = parse(oldDateStr)\n\n    # store the number of days to offset for later\n    dayOffset = (datetime.now() - oldTimestamp).days\n\n    # Shift the date by the dayOffset\n    df[\"shifted_dt\"] = df.dt + pd.Timedelta(days=dayOffset)\n\n    # Convert the shifted_dt to a datetime dataframe\n    date_time = pd.to_datetime(df[\"shifted_dt\"], format=\"%Y-%M-%D %H:%M:%S\")\n\n    dayInMins = 24 * 60\n\n    timestamp_s = date_time.map(pd.Timestamp.timestamp)\n    df[\"timestamp_s\"] = timestamp_s\n    df[\"Day sin\"] = np.sin(timestamp_s * (2 * np.pi / dayInMins))\n    df[\"Day cos\"] = np.cos(timestamp_s * (2 * np.pi / dayInMins))\n\n    # Filter the df to only include the columns we need for the model\n    dfs[room] = df[LABELS].tail(10)"}]}],["$","p","44",{"className":"$undefined","children":["Essentially this method takes the original dataset, and finds the last record that matches the current day, hour and minute. It then slices the dataset from the start to the index of the last record. The date is then shifted by the number of days between the last record and the current timestamp. This creates a df that is simulating the current historical data. The df is later converted to a numpy array and is then passed to the ",["$","strong","3",{"className":"$undefined","children":[["$","code","0",{"className":"$undefined","children":"IEQ Predictor"}]]}]," API, which generates a new reading for each of the sensors. The data is then published to InfluxDB, which is then visualised in Grafana. This approach also ensures that the data being used in production is realistic, and is based on real data, but is not the same data that was used to train the model. The actual sample that is selected comes from the test/validation dataset, which was not used to train the model. This prevents the model from just returning the same data that was used to train it."]}],["$","p","45",{"className":"$undefined","children":["The Dockerfile for the IoT Simulator service can be found here:"]}],["$","pre","46",{"className":"$undefined","children":["$","code",null,{"className":"lang-docker","children":"\nFROM python:3.11.4-slim\n\nCOPY main.py ./\nCOPY models.py ./\nCOPY ImputationResult.csv ./\nCOPY requirements.txt ./\nCOPY .env ./\n\nRUN /usr/local/bin/python -m pip install --upgrade pip && pip3 install -r requirements.txt\n\nCMD [\"python\", \"main.py\"]"}]}],["$","h3","47",{"id":"mqtt","className":"$undefined","children":["MQTT"]}],["$","p","48",{"className":"$undefined","children":["I had originally developed (and actually have) a working stack that uses a local Mosquitto MQTT broker. However, since the client application is hosted behind an SSL certificate, due to secure CloudFlare tunnels, I was unable to connect to the local broker. I had tried to use a reverse proxy to connect to the local broker, but this was conflicting with the CloudFlare tunnels I setup for this application. I then decided to use a public MQTT broker for the purposes of testing, which would allow me to connect to the broker from via a secure websocker from the client application. I used the EMQX broker, which is a public broker that allows you to create a free account. The client application connects to the broker using the Paho MQTT library, and the client subscribes to the following topics:"]}],["$","table","49",{"className":"$undefined","children":[["$","thead",null,{"className":"$undefined","children":["$","tr",null,{"className":"$undefined","children":[["$","th","0",{"style":{},"className":"$undefined","children":["ParentTopic"]}],["$","th","1",{"style":{},"className":"$undefined","children":["Room"]}],["$","th","2",{"style":{},"className":"$undefined","children":["Sensor"]}],["$","th","3",{"style":{},"className":"$undefined","children":["Topic"]}]]}]}],["$","tbody",null,{"className":"$undefined","children":[["$","tr","0",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["CO2"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/BoardRoom/CO2"]}]]}],["$","tr","1",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["eCO2"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/BoardRoom/eCO2"]}]]}],["$","tr","2",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Temperature"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/BoardRoom/Temperature"]}]]}],["$","tr","3",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Humidity"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/BoardRoom/Humidity"]}]]}],["$","tr","4",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Light"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/BoardRoom/Light"]}]]}],["$","tr","5",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Sound"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/BoardRoom/Sound"]}]]}],["$","tr","6",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Pressure"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/BoardRoom/Pressure"]}]]}],["$","tr","7",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["OpenPlanOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["CO2"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/OpenPlanOffice/CO2"]}]]}],["$","tr","8",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["OpenPlanOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["eCO2"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/OpenPlanOffice/eCO2"]}]]}],["$","tr","9",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["OpenPlanOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Temperature"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/OpenPlanOffice/Temperature"]}]]}],["$","tr","10",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["OpenPlanOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Humidity"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/OpenPlanOffice/Humidity"]}]]}],["$","tr","11",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["OpenPlanOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Light"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/OpenPlanOffice/Light"]}]]}],["$","tr","12",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["OpenPlanOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Sound"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/OpenPlanOffice/Sound"]}]]}],["$","tr","13",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["OpenPlanOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Pressure"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/OpenPlanOffice/Pressure"]}]]}],["$","tr","14",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["MultiOccupantOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["CO2"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/MultiOccupantOffice/CO2"]}]]}],["$","tr","15",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["MultiOccupantOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["eCO2"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/MultiOccupantOffice/eCO2"]}]]}],["$","tr","16",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["MultiOccupantOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Temperature"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/MultiOccupantOffice/Temperature"]}]]}],["$","tr","17",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["MultiOccupantOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Humidity"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/MultiOccupantOffice/Humidity"]}]]}],["$","tr","18",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["MultiOccupantOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Light"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/MultiOccupantOffice/Light"]}]]}],["$","tr","19",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["MultiOccupantOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Sound"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/MultiOccupantOffice/Sound"]}]]}],["$","tr","20",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["VirtualSmartOffice"]}],["$","td","1",{"style":{},"className":"$undefined","children":["MultiOccupantOffice"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Pressure"]}],["$","td","3",{"style":{},"className":"$undefined","children":["VirtualSmartOffice/MultiOccupantOffice/Pressure"]}]]}]]}]]}],["$","p","50",{"className":"$undefined","children":[["$","img","0",{"alt":"screenshot","title":"$undefined","src":"/project-images/virtual-smart-office/6.png","className":"$undefined"}]]}],["$","h3","51",{"id":"timeseries-database-influxdb","className":"$undefined","children":["Timeseries Database (InfluxDB)"]}],["$","p","52",{"className":"$undefined","children":["I chose to use InfluxDB because it is a time series database, which is ideal for storing the sensor data. The data is stored in the following format:"]}],["$","table","53",{"className":"$undefined","children":[["$","thead",null,{"className":"$undefined","children":["$","tr",null,{"className":"$undefined","children":[["$","th","0",{"style":{},"className":"$undefined","children":["Time"]}],["$","th","1",{"style":{},"className":"$undefined","children":["Room"]}],["$","th","2",{"style":{},"className":"$undefined","children":["Sensor"]}],["$","th","3",{"style":{},"className":"$undefined","children":["Value"]}]]}]}],["$","tbody",null,{"className":"$undefined","children":[["$","tr","0",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["2021-05-01T00:00:00Z"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["CO2"]}],["$","td","3",{"style":{},"className":"$undefined","children":["400"]}]]}],["$","tr","1",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["2021-05-01T00:00:00Z"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["eCO2"]}],["$","td","3",{"style":{},"className":"$undefined","children":["400"]}]]}],["$","tr","2",{"className":"$undefined","children":[["$","td","0",{"style":{},"className":"$undefined","children":["2021-05-01T00:00:00Z"]}],["$","td","1",{"style":{},"className":"$undefined","children":["BoardRoom"]}],["$","td","2",{"style":{},"className":"$undefined","children":["Temperature"]}],["$","td","3",{"style":{},"className":"$undefined","children":["20"]}]]}]]}]]}],["$","p","54",{"className":"$undefined","children":["the data is then visualised in Grafana. Timeseries databases are ideal for storing data that is generated over time, and is often used for IoT applications. InfluxDB is also very easy to setup and use, and has a very good integration with Grafana."]}],["$","p","55",{"className":"$undefined","children":["The docker-compose file for the InfluxDB service can be found here:"]}],["$","pre","56",{"className":"$undefined","children":["$","code",null,{"className":"lang-yml","children":"version: \"3\"\n\nnetworks:\n  metrics:\n    external: false\n\nservices:\n  influxdb:\n    image: influxdb:latest\n    container_name: influxdb\n    restart: always\n    networks: [metrics]\n    ports:\n      - \"8086:8086\"\n    volumes:\n      - $HOME/docker/influxdb/data:/var/lib/influxdb\n      - $HOME/docker/influxdb/influxdb.conf:/etc/influxdb/influxdb.conf:ro\n      - $HOME/docker/influxdb/init:/docker-entrypoint-initdb.d\n    environment:\n      - INFLUXDB_ADMIN_USER=${INFLUXDB_USERNAME} # sourced from .env\n      - INFLUXDB_ADMIN_PASSWORD=${INFLUXDB_PASSWORD} # sourced from .env"}]}],["$","p","57",{"className":"$undefined","children":[["$","img","0",{"alt":"screenshot","title":"$undefined","src":"/project-images/virtual-smart-office/4.png","className":"$undefined"}]]}],["$","h3","58",{"id":"data-visualisations-grafana","className":"$undefined","children":["Data Visualisations (Grafana)"]}],["$","p","59",{"className":"$undefined","children":["Grafana was chosen because its has a very good integration with InfluxDB, and it is very easy to setup and use. Grafana is a data visualisation tool that allows you to create dashboards that can be used to visualise data from a variety of sources. Grafana is also very easy to setup and use, and has a very good integration with InfluxDB. The dashboards can be made public, which allows them to be embedded into external applications with ease... So long as the following environment variables are setup when the container is created:"]}],["$","pre","60",{"className":"$undefined","children":["$","code",null,{"className":"lang-bash","children":"- GF_SECURITY_ALLOW_EMBEDDING=true\n- GF_FEATURE_TOGGLES_ENABLE=publicDashboards"}]}],["$","p","61",{"className":"$undefined","children":["The full docker-compose file for the Grafana service can be found here:"]}],["$","pre","62",{"className":"$undefined","children":["$","code",null,{"className":"lang-yml","children":"services:\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    security_opt:\n      - no-new-privileges:true\n    restart: unless-stopped\n    networks:\n      - default\n    ports:\n      - \"7564:3000\"\n    # volumes:\n    #   - ./data/grafana-storage:/var/lib/grafana:Z\n    #   - ./data/grafana-provisioning:/etc/grafana/provisioning:Z\n    environment:\n      - GF_SECURITY_ADMIN_USER=${GRAFANA_USERNAME}\n      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}\n      - GF_SECURITY_ALLOW_EMBEDDING=true\n      - GF_FEATURE_TOGGLES_ENABLE=publicDashboards"}]}],["$","p","63",{"className":"$undefined","children":[["$","img","0",{"alt":"screenshot","title":"$undefined","src":"/project-images/virtual-smart-office/2.png","className":"$undefined"}]]}],["$","h3","64",{"id":"docker-and-docker-compose","className":"$undefined","children":["Docker and Docker Compose"]}],["$","p","65",{"className":"$undefined","children":["Each service within this stack is containerised using Docker and brought online using ",["$","code","1",{"className":"$undefined","children":"docker-compose"}],". Wherever possible I try to use Docker Compose over vanilla Docker because it is much easier to manage multiple containers using a single ",["$","code","3",{"className":"$undefined","children":"docker-compose.yml"}]," file and the files are both easier to understand and give you a persistent record of the configuration of the stack."]}],["$","h3","66",{"id":"cloudflare","className":"$undefined","children":["CloudFlare"]}],["$","p","67",{"className":"$undefined","children":["I migrated to CloudFlare as my domain provide about a year ago as I was using the service for caching and traffic monitoring. For this project I setup tunnels to provide DNS records for services running on ",["$","strong","1",{"className":"$undefined","children":[["$","code","0",{"className":"$undefined","children":"Oracle Cloud Infrastructure"}]]}],". I also used CloudFlare to generate the SSL certificates for those services."]}],["$","h3","68",{"id":"oracle-cloud-infrastructure","className":"$undefined","children":["Oracle Cloud Infrastructure"]}],["$","p","69",{"className":"$undefined","children":["I used Oracle Cloud Infrastructure to host all of the services in this stack. I chose to use Oracle Cloud Infrastructure because I was able to get a free ARM instance with 24GB of RAM and 4 vCPUs. Previously I have used this just for testing docker images, but I found that it was more than capable of running the entire stack, with plenty of room to spare. I was keen to use a cloud provider for this project as not only did I want it to be accessible from anywhere, I wanted the project to be realistic to typical IoT deployments, which would typically be hosted in the cloud."]}],["$","h3","70",{"id":"api","className":"$undefined","children":["API"]}],["$","p","71",{"className":"$undefined","children":["I intend to develop a second FastAPI service, which will be used to provide an API for the InfluxDB database. This will provide a persistent API for capturing simulated sensor data for testing and development purposes. This will be developed in a separate repository."]}],["$","hr","72",{"className":"$undefined"}],["$","p","73",{"className":"$undefined","children":["Try the Client App:"]}],["$","a","74",{"className":"btn btn-dark","href":"https://iot-sim.grahamcoulby.co.uk/","target":"_blank","rel":"noopener noreferrer","children":[["$","i","0",{"className":"fa fa-globe","children":[]}]," Try the Client App\n"]}],["$","p","75",{"className":"$undefined","children":["Try the Mobile Controller:"]}],["$","a","76",{"className":"btn btn-dark","href":"https://iot-sim-controller.grahamcoulby.co.uk/","target":"_blank","rel":"noopener noreferrer","children":[["$","i","0",{"className":"fa fa-globe","children":[]}]," Try the Mobile Controller\n"]}],["$","p","77",{"className":"$undefined","children":["View the Dashboard:"]}],["$","a","78",{"className":"btn btn-dark","href":"https://grafana.grahamcoulby.co.uk/public-dashboards/15c1218cf7744fb6969bbd9bd26ce287?orgId=1&refresh=10s&kiosk","target":"_blank","rel":"noopener noreferrer","children":[["$","i","0",{"className":"fa fa-globe","children":[]}]," View the Dashboard\n"]}],["$","p","79",{"className":"$undefined","children":["Read the API Docs:"]}],["$","a","80",{"className":"btn btn-dark","href":"https://ieq-predict.grahamcoulby.co.uk/docs","target":"_blank","rel":"noopener noreferrer","children":[["$","i","0",{"className":"fa fa-globe","children":[]}]," Read the API Docs\n"]}]]}]}]]}]}]]}]}],null],"segment":"__PAGE__?{\"slug\":\"virtual-smart-office\"}"},"styles":[]}],"segment":["slug","virtual-smart-office","d"]},"styles":[]}],"segment":"portfolio"},"styles":[]}]}]}],null]
5:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Graham Coulby"}],["$","meta","2",{"name":"description","content":"Home page for Graham Coulby"}],["$","link","3",{"rel":"manifest","href":"/img/site.webmanifest"}],["$","meta","4",{"name":"viewport","content":"width=device-width, initial-scale=0.85"}],["$","meta","5",{"property":"og:title","content":"Graham Coulby"}],["$","meta","6",{"property":"og:description","content":"Graham Coulby is a post-doc computer scientist who is interested in reserarch, IoT, embedded systems and full-stack development."}],["$","meta","7",{"property":"og:url","content":"http://grahamcoulby.co.uk/"}],["$","meta","8",{"property":"og:locale","content":"en_GB"}],["$","meta","9",{"property":"og:type","content":"website"}],["$","meta","10",{"name":"twitter:card","content":"summary"}],["$","meta","11",{"name":"twitter:title","content":"Graham Coulby"}],["$","meta","12",{"name":"twitter:description","content":"Graham Coulby is a post-doc computer scientist who is interested in reserarch, IoT, embedded systems and full-stack development."}],["$","link","13",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}],["$","link","14",{"rel":"icon","href":"/icon.png?8c419b8fdc4a0f79","type":"image/png","sizes":"32x32"}],["$","link","15",{"rel":"apple-touch-icon","href":"/apple-icon.png?eda77df8ba9976b2","type":"image/png","sizes":"180x180"}]]
