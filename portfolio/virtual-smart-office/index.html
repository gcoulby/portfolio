<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/2aaf0723e720e8b9-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/d936dfcfc963df13.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/017368e0e2994f4b.css" data-precedence="next"/><title>Graham Coulby</title><meta name="description" content="Home page for Graham Coulby"/><link rel="manifest" href="/img/site.webmanifest"/><meta name="viewport" content="width=device-width, initial-scale=0.85"/><meta property="og:title" content="Graham Coulby"/><meta property="og:description" content="Graham Coulby is a post-doc computer scientist who is interested in reserarch, IoT, embedded systems and full-stack development."/><meta property="og:url" content="http://grahamcoulby.co.uk/"/><meta property="og:locale" content="en_GB"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Graham Coulby"/><meta name="twitter:description" content="Graham Coulby is a post-doc computer scientist who is interested in reserarch, IoT, embedded systems and full-stack development."/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><link rel="icon" href="/icon.png?8c419b8fdc4a0f79" type="image/png" sizes="32x32"/><link rel="apple-touch-icon" href="/apple-icon.png?eda77df8ba9976b2" type="image/png" sizes="180x180"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_0ec1f4"><div><div class="modular"><nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="sideNav"><a class="navbar-brand js-scroll-trigger" href="/"><span class="d-block d-lg-none">Graham Coulby</span><span class="d-none d-lg-block"><img src="/_next/static/media/logo.625befc3.png" class="img-fluid img-profile mx-auto mb-2" alt=""/></span></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="navbarSupportedContent"><ul class="navbar-nav"><li class="nav-item"><a class="nav-link js-scroll-trigger" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg> Home</a></li><li class="nav-item"><a class="nav-link js-scroll-trigger" href="/portfolio/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 256 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"></path></svg> Go Back</a></li></ul></div></nav><section class="resume-section" id="o"><div class="resume-section-content"><h3 class="text-dark">Virtual Smart Office</h3><p>An AI enabled, demonstration of principal Internet of Things (IoT) technologies (e.g., MQTT brokers, timeseries databases, real-time data capture) built on a real-time, cloud-based, microservice architecture.</p><article class="prose"><div><p>| NOTE: This project writeup is currently under development.</p><p>The Virtual Smart Office is a simulated environment to showcase Internet of Things principals and technologies.</p><p>The simulator is built using microservice architecture running on Docker, through a docker-compose stack. The stack offers a one-stop-shop to deliver a series of microservices that</p><h3 id="client-application">Client Application</h3><p>The purpose of the client application is to provide a dashboard and ‘front-end’ to the Virtual Smart Office.</p><p><img alt="screenshot" src="/project-images/virtual-smart-office/feature.png"/></p><h4 id="svg-model">SVG Model</h4><p>The application provides a graphical SVG model, which I got from FreePik during my Ph.D. I modified the SVG using Affinity Designer and added interactive elements that can be ‘turned on’ and ‘turned off’. These elements are:</p><ul><li>Air Conditioners</li><li>Air Purifiers</li><li>Lights</li></ul><p>The state of these elements is controlled by MQTT messages, which are published and subscribed to by the client application. The client application also publishes MQTT messages to control the state of these elements.</p><p><img alt="screenshot" src="/project-images/virtual-smart-office/5.png"/></p><h4 id="mqtt-controls">MQTT Controls</h4><p>The client also displays a series of toggle switches. These provide a real-time, multi-pub/sub interface, whereby multiple clients can publish and subscribe to the MQTT messages being transmitted/received from/to the client.</p><blockquote><p>The virtual Air Conditioners and Air Purifiers used in this simulation do not have an effect on the data generated in the graphs. Their only purpose is to simulate/showcase MQTT control over the building.</p></blockquote><h4 id="data-graphs">Data Graphs</h4><p>The application also displays sensor telemetry from simulated IoT environmental quality sensors. The data from these ‘devices’ are generated by the <strong><code>IEQ Simulator</code></strong> service, which is explained below. The graph dashboard is embedded into this application and is generated using Grafana, which takes a data feed from InfluxDB.</p><h4 id="mobile-application">Mobile Application</h4><p>There is a mobile application as well, which is accessible via the QR code on the client application (<a href="https://iot-sim-controller.grahamcoulby.co.uk/">https://iot-sim-controller.grahamcoulby.co.uk/</a>). The mobile application is actually the same React application, but with a different UI. The docker-compose file uses the same build command as the client application:</p><pre><code class="lang-docker">build: ./client/</code></pre><p>However, the mobile application sets the following flag in the environment variables:</p><pre><code class="lang-bash">REACT_APP_MOBILE=true</code></pre><p>When the React app sees this flag, it shows only the toggle switches and the connect buttons, this saved writing two separate implementations of the application - but also allows the main application to be scalable to different screen sizes - without limiting the functionality of the application.</p><p><img alt="screenshot" src="/project-images/virtual-smart-office/3.png"/></p><hr/><h3 id="ieq-predictor-api">IEQ Predictor API</h3><p>An IEQ predictor API was created to generate realistic &#x27;fake&#x27; sensor data. The data are generated using an <strong>Autoregressive Long Short Term Memory Neural Network,</strong> which is trained on IEQ data captured from a previous study entitled “Personalised and Sustainable IEQ Monitoring: Use of Multi-Modal and Pervasive Technologies” (<a href="https://doi.org/10.3390/ijerph20064897">https://doi.org/10.3390/ijerph20064897</a>). The data were captured from a series of sensors placed in a physical study location. The data were captured over a period of 6 months, and the data were captured at 1-minute intervals. Data were captured from the following sensors:</p><ul><li>CO2 Sensor</li><li>eCO2 Sensor</li><li>Temperature Sensor</li><li>Humidity Sensor</li><li>Light Sensor</li><li>Sound Sensor</li><li>Pressure Sensor</li></ul><p>The LSTM model was trained to generate a new sensor reading for each of the sensors based on the previous 10 readings. The model was trained on 70% of the data, and the remaining 30% was used to validated and test the model. The model was trained using the Keras library, and the model was saved as a .h5 file. The model was then integrated into a FastAPI application, which provides data to the <strong><code>IEQ Simulator</code></strong> service. The documentation for the API can be found here: <a href="https://ieq-predict.grahamcoulby.co.uk/docs">https://ieq-predict.grahamcoulby.co.uk/docs</a></p><p><img alt="screenshot" src="/project-images/virtual-smart-office/1.png"/></p><h3 id="iot-simulator-service">IoT Simulator Service</h3><p>The IoT Simulator service is a python application that generates simulated data from a series of IoT devices. The application calls the <strong><code>IEQ Predictor</code></strong> API to generate the data for the sensors. Since the <strong><code>IEQ Predictor</code></strong> service requires the previous 10 readings to generate a new reading, the IoT Simulator service creates the payload for the API by taking a sample from the original dataset used to train the model.</p><p>To create the data the following method is used:</p><pre><code class="lang-python">
def build_df(room, dayOffset=0):
    &quot;&quot;&quot;Builds the df from the ImputationResult.csv file. This file contains
    the imputed data from a previous study (https://doi.org/10.3390/ijerph20064897)
    and is used to train the model. The df is built by reading the CSV file
    and adjusting the timestamps to the current time. This is done by finding the
    last record in the df with the same day, hour and minute as the current
    timestamp. The df is then sliced from the start to the index of the last
    record. The date is then shifted by the number of days between the last record
    and the current timestamp. This creates a df that is simulating the current
    historical data.
    &quot;&quot;&quot;
    global dfs
    # Read in the CSV data
    df = pd.read_csv(f&quot;{BASE_PATH}/ImputationResult.csv&quot;)

    df[&quot;dt&quot;] = pd.to_datetime(df.pop(&quot;dt&quot;), format=&quot;%Y-%m-%d %H:%M:%S&quot;)

    # Get current time
    now = datetime.now(pytz.timezone(&quot;Europe/London&quot;))
    hour = now.hour
    minute = now.minute
    weekday = now.weekday() + 1 - dayOffset
    if weekday &lt;= 0:
        weekday = 7
    elif weekday &gt; 7:
        weekday = 1

    # Get the last index from the df where the Day, Hour and Minute
    # match the current timestamp
    idx = np.where(
        df[&quot;DayNumber&quot;].eq(weekday) &amp; df[&quot;Hour&quot;].eq(hour) &amp; df[&quot;Minute&quot;].eq(minute + 1)
    )[0][-1]

    # Set the dateframe to a slice from start to the previously found index
    df = df[:idx]

    # find the datetime in the lastrow and use it to find the number of days
    # that have passed between that datapoint and the current timestamp
    lastRow = df.iloc[-1]
    oldDateStr = f&quot;{lastRow[&#x27;dt&#x27;]} {lastRow[&#x27;Hour&#x27;]}:{lastRow[&#x27;Minute&#x27;]}&quot;
    oldTimestamp = parse(oldDateStr)

    # store the number of days to offset for later
    dayOffset = (datetime.now() - oldTimestamp).days

    # Shift the date by the dayOffset
    df[&quot;shifted_dt&quot;] = df.dt + pd.Timedelta(days=dayOffset)

    # Convert the shifted_dt to a datetime dataframe
    date_time = pd.to_datetime(df[&quot;shifted_dt&quot;], format=&quot;%Y-%M-%D %H:%M:%S&quot;)

    dayInMins = 24 * 60

    timestamp_s = date_time.map(pd.Timestamp.timestamp)
    df[&quot;timestamp_s&quot;] = timestamp_s
    df[&quot;Day sin&quot;] = np.sin(timestamp_s * (2 * np.pi / dayInMins))
    df[&quot;Day cos&quot;] = np.cos(timestamp_s * (2 * np.pi / dayInMins))

    # Filter the df to only include the columns we need for the model
    dfs[room] = df[LABELS].tail(10)</code></pre><p>Essentially this method takes the original dataset, and finds the last record that matches the current day, hour and minute. It then slices the dataset from the start to the index of the last record. The date is then shifted by the number of days between the last record and the current timestamp. This creates a df that is simulating the current historical data. The df is later converted to a numpy array and is then passed to the <strong><code>IEQ Predictor</code></strong> API, which generates a new reading for each of the sensors. The data is then published to InfluxDB, which is then visualised in Grafana.</p><h3 id="mqtt">MQTT</h3><p>I had originally developed (and actually have) a working stack that uses a local Mosquitto MQTT broker. However, since the client application is hosted behind an SSL certificate, I was unable to connect to the local broker. I had tried to use a reverse proxy to connect to the local broker, but this was conflicting with the CloudFlare tunnels I setup for this application. I then decided to use a public MQTT broker for the purposes of testing, which would allow me to connect to the broker from via a secure websocker from the client application. I used the EMQX broker, which is a public broker that allows you to create a free account. The client application connects to the broker using the Paho MQTT library, and the client subscribes to the following topics:</p><table><thead><tr><th>ParentTopic</th><th>Room</th><th>Sensor</th><th>Topic</th></tr></thead><tbody><tr><td>VirtualSmartOffice</td><td>BoardRoom</td><td>CO2</td><td>VirtualSmartOffice/BoardRoom/CO2</td></tr><tr><td>VirtualSmartOffice</td><td>BoardRoom</td><td>eCO2</td><td>VirtualSmartOffice/BoardRoom/eCO2</td></tr><tr><td>VirtualSmartOffice</td><td>BoardRoom</td><td>Temperature</td><td>VirtualSmartOffice/BoardRoom/Temperature</td></tr><tr><td>VirtualSmartOffice</td><td>BoardRoom</td><td>Humidity</td><td>VirtualSmartOffice/BoardRoom/Humidity</td></tr><tr><td>VirtualSmartOffice</td><td>BoardRoom</td><td>Light</td><td>VirtualSmartOffice/BoardRoom/Light</td></tr><tr><td>VirtualSmartOffice</td><td>BoardRoom</td><td>Sound</td><td>VirtualSmartOffice/BoardRoom/Sound</td></tr><tr><td>VirtualSmartOffice</td><td>BoardRoom</td><td>Pressure</td><td>VirtualSmartOffice/BoardRoom/Pressure</td></tr><tr><td>VirtualSmartOffice</td><td>OpenPlanOffice</td><td>CO2</td><td>VirtualSmartOffice/OpenPlanOffice/CO2</td></tr><tr><td>VirtualSmartOffice</td><td>OpenPlanOffice</td><td>eCO2</td><td>VirtualSmartOffice/OpenPlanOffice/eCO2</td></tr><tr><td>VirtualSmartOffice</td><td>OpenPlanOffice</td><td>Temperature</td><td>VirtualSmartOffice/OpenPlanOffice/Temperature</td></tr><tr><td>VirtualSmartOffice</td><td>OpenPlanOffice</td><td>Humidity</td><td>VirtualSmartOffice/OpenPlanOffice/Humidity</td></tr><tr><td>VirtualSmartOffice</td><td>OpenPlanOffice</td><td>Light</td><td>VirtualSmartOffice/OpenPlanOffice/Light</td></tr><tr><td>VirtualSmartOffice</td><td>OpenPlanOffice</td><td>Sound</td><td>VirtualSmartOffice/OpenPlanOffice/Sound</td></tr><tr><td>VirtualSmartOffice</td><td>OpenPlanOffice</td><td>Pressure</td><td>VirtualSmartOffice/OpenPlanOffice/Pressure</td></tr><tr><td>VirtualSmartOffice</td><td>MultiOccupantOffice</td><td>CO2</td><td>VirtualSmartOffice/MultiOccupantOffice/CO2</td></tr><tr><td>VirtualSmartOffice</td><td>MultiOccupantOffice</td><td>eCO2</td><td>VirtualSmartOffice/MultiOccupantOffice/eCO2</td></tr><tr><td>VirtualSmartOffice</td><td>MultiOccupantOffice</td><td>Temperature</td><td>VirtualSmartOffice/MultiOccupantOffice/Temperature</td></tr><tr><td>VirtualSmartOffice</td><td>MultiOccupantOffice</td><td>Humidity</td><td>VirtualSmartOffice/MultiOccupantOffice/Humidity</td></tr><tr><td>VirtualSmartOffice</td><td>MultiOccupantOffice</td><td>Light</td><td>VirtualSmartOffice/MultiOccupantOffice/Light</td></tr><tr><td>VirtualSmartOffice</td><td>MultiOccupantOffice</td><td>Sound</td><td>VirtualSmartOffice/MultiOccupantOffice/Sound</td></tr><tr><td>VirtualSmartOffice</td><td>MultiOccupantOffice</td><td>Pressure</td><td>VirtualSmartOffice/MultiOccupantOffice/Pressure</td></tr></tbody></table><p><img alt="screenshot" src="/project-images/virtual-smart-office/6.png"/></p><h3 id="timeseries-database-influxdb">Timeseries Database (InfluxDB)</h3><p>I chose to use InfluxDB because it is a time series database, which is ideal for storing the sensor data. The data is stored in the following format:</p><table><thead><tr><th>Time</th><th>Room</th><th>Sensor</th><th>Value</th></tr></thead><tbody><tr><td>2021-05-01T00:00:00Z</td><td>BoardRoom</td><td>CO2</td><td>400</td></tr><tr><td>2021-05-01T00:00:00Z</td><td>BoardRoom</td><td>eCO2</td><td>400</td></tr><tr><td>2021-05-01T00:00:00Z</td><td>BoardRoom</td><td>Temperature</td><td>20</td></tr></tbody></table><p>the data is then visualised in Grafana. Timeseries databases are ideal for storing data that is generated over time, and is often used for IoT applications. InfluxDB is also very easy to setup and use, and has a very good integration with Grafana.</p><p><img alt="screenshot" src="/project-images/virtual-smart-office/4.png"/></p><h3 id="data-visualisations-grafana">Data Visualisations (Grafana)</h3><p>Grafana was chosen because its has a very good integration with InfluxDB, and it is very easy to setup and use. Grafana is a data visualisation tool that allows you to create dashboards that can be used to visualise data from a variety of sources. Grafana is also very easy to setup and use, and has a very good integration with InfluxDB. The dashboards can be made public, which allows them to be embedded into external applications with ease... So long as the following environment variables are setup when the container is created:</p><pre><code class="lang-bash">- GF_SECURITY_ALLOW_EMBEDDING=true
- GF_FEATURE_TOGGLES_ENABLE=publicDashboards</code></pre><p><img alt="screenshot" src="/project-images/virtual-smart-office/2.png"/></p><h3 id="docker-and-docker-compose">Docker and Docker Compose</h3><p>Each service within this stack is containerised using Docker and brought online using <code>docker-compose</code>. Wherever possible I try to use Docker Compose over vanilla Docker because it is much easier to manage multiple containers using a single <code>docker-compose.yml</code> file and the files are both easier to understand and give you a persistent record of the configuration of the stack.</p><h3 id="cloudflare">CloudFlare</h3><p>I migrated to CloudFlare as my domain provide about a year ago as I was using the service for caching and traffic monitoring. For this project I setup tunnels to provide DNS records for services running on <strong><code>Oracle Cloud Infrastructure</code></strong>. I also used CloudFlare to generate the SSL certificates for those services.</p><h3 id="oracle-cloud-infrastructure">Oracle Cloud Infrastructure</h3><p>I used Oracle Cloud Infrastructure to host all of the services in this stack. I chose to use Oracle Cloud Infrastructure because I was able to get a free ARM instance with 24GB of RAM and 4 vCPUs. Previously I have used this just for testing docker images, but I found that it was more than capable of running the entire stack, with plenty of room to spare. I was keen to use a cloud provider for this project as not only did I want it to be accessible from anywhere, I wanted the project to be realistic to typical IoT deployments, which would typically be hosted in the cloud.</p><h3 id="api">API</h3><p>I intend to develop a second FastAPI service, which will be used to provide an API for the InfluxDB database. This will provide a persistent API for capturing simulated sensor data for testing and development purposes. This will be developed in a separate repository.</p><hr/><p>Try the Client App:</p><a class="btn btn-dark" href="https://iot-sim.grahamcoulby.co.uk/" target="_blank" rel="noopener noreferrer"><i class="fa fa-globe"></i> Try the Client App
</a><p>Try the Mobile Controller:</p><a class="btn btn-dark" href="https://iot-sim-controller.grahamcoulby.co.uk/" target="_blank" rel="noopener noreferrer"><i class="fa fa-globe"></i> Try the Mobile Controller
</a><p>View the Dashboard:</p><a class="btn btn-dark" href="https://grafana.grahamcoulby.co.uk/public-dashboards/15c1218cf7744fb6969bbd9bd26ce287?orgId=1&amp;refresh=10s&amp;kiosk" target="_blank" rel="noopener noreferrer"><i class="fa fa-globe"></i> View the Dashboard
</a><p>Read the API Docs:</p><a class="btn btn-dark" href="https://ieq-predict.grahamcoulby.co.uk/docs" target="_blank" rel="noopener noreferrer"><i class="fa fa-globe"></i> Read the API Docs
</a></div></article></div></section></div></div><script src="/_next/static/chunks/webpack-3c1d123b9e459758.js" async=""></script><script src="/_next/static/chunks/bce60fc1-f330208a48f279d5.js" async=""></script><script src="/_next/static/chunks/488-91a7cb7a32fe40e5.js" async=""></script><script src="/_next/static/chunks/main-app-2fc2f8494abba554.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2aaf0723e720e8b9-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/d936dfcfc963df13.css\",{\"as\":\"style\"}]\n3:HL[\"/_next/static/css/017368e0e2994f4b.css\",{\"as\":\"style\"}]\n0:\"$L4\"\n"])</script><script>self.__next_f.push([1,"5:I{\"id\":\"8827\",\"chunks\":[\"272:static/chunks/webpack-3c1d123b9e459758.js\",\"253:static/chunks/bce60fc1-f330208a48f279d5.js\",\"488:static/chunks/488-91a7cb7a32fe40e5.js\"],\"name\":\"\",\"async\":false}\n7:I{\"id\":\"9126\",\"chunks\":[\"272:static/chunks/webpack-3c1d123b9e459758.js\",\"253:static/chunks/bce60fc1-f330208a48f279d5.js\",\"488:static/chunks/488-91a7cb7a32fe40e5.js\"],\"name\":\"\",\"async\":false}\n9:I{\"id\":\"4463\",\"chunks\":[\"272:static/chunks/webpack-3c1d123b9e459758.js\",\"253:static/chunks/bce60fc1-f330208a48f279d5.js\",\"48"])</script><script>self.__next_f.push([1,"8:static/chunks/488-91a7cb7a32fe40e5.js\"],\"name\":\"\",\"async\":false}\na:I{\"id\":\"1010\",\"chunks\":[\"272:static/chunks/webpack-3c1d123b9e459758.js\",\"253:static/chunks/bce60fc1-f330208a48f279d5.js\",\"488:static/chunks/488-91a7cb7a32fe40e5.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":\"8164\",\"chunks\":[\"296:static/chunks/2e3a737e-8c0b8a5ba6590718.js\",\"920:static/chunks/920-9b6e70f29bd7ba21.js\",\"849:static/chunks/app/portfolio/[slug]/page-b8e5053cb5ba7338.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"4:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/d936dfcfc963df13.css\",\"precedence\":\"next\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/017368e0e2994f4b.css\",\"precedence\":\"next\"}]],[\"$\",\"$L5\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/portfolio/virtual-smart-office/\",\"initialTree\":[\"\",{\"children\":[\"portfolio\",{\"children\":[[\"slug\",\"virtual-smart-office\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"virtual-smart-office\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$L6\",[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]],\"globalErrorComponent\":\"$7\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$L8\",\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"portfolio\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"portfolio\",\"children\",[\"slug\",\"virtual-smart-office\",\"d\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[[\"$\",\"div\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"modular\",\"children\":[[\"$\",\"$Lb\",null,{\"keyWords\":[],\"showTags\":false}],[\"$\",\"section\",null,{\"className\":\"resume-section\",\"id\":\"o\",\"children\":[\"$\",\"div\",null,{\"className\":\"resume-section-content\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"text-dark\",\"children\":\"Virtual Smart Office\"}],[\"$\",\"p\",null,{\"children\":\"An AI enabled, demonstration of principal Internet of Things (IoT) technologies (e.g., MQTT brokers, timeseries databases, real-time data capture) built on a real-time, cloud-based, microservice architecture.\"}],[\"$\",\"article\",null,{\"className\":\"prose\",\"children\":[\"$\",\"div\",\"outer\",{\"children\":[[\"$\",\"p\",\"0\",{\"className\":\"$undefined\",\"children\":[\"| NOTE: This project writeup is currently under development.\"]}],[\"$\",\"p\",\"1\",{\"className\":\"$undefined\",\"children\":[\"The Virtual Smart Office is a simulated environment to showcase Internet of Things principals and technologies.\"]}],[\"$\",\"p\",\"2\",{\"className\":\"$undefined\",\"children\":[\"The simulator is built using microservice architecture running on Docker, through a docker-compose stack. The stack offers a one-stop-shop to deliver a series of microservices that\"]}],[\"$\",\"h3\",\"3\",{\"id\":\"client-application\",\"className\":\"$undefined\",\"children\":[\"Client Application\"]}],[\"$\",\"p\",\"4\",{\"className\":\"$undefined\",\"children\":[\"The purpose of the client application is to provide a dashboard and ‘front-end’ to the Virtual Smart Office.\"]}],[\"$\",\"p\",\"5\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"img\",\"0\",{\"alt\":\"screenshot\",\"title\":\"$undefined\",\"src\":\"/project-images/virtual-smart-office/feature.png\",\"className\":\"$undefined\"}]]}],[\"$\",\"h4\",\"6\",{\"id\":\"svg-model\",\"className\":\"$undefined\",\"children\":[\"SVG Model\"]}],[\"$\",\"p\",\"7\",{\"className\":\"$undefined\",\"children\":[\"The application provides a graphical SVG model, which I got from FreePik during my Ph.D. I modified the SVG using Affinity Designer and added interactive elements that can be ‘turned on’ and ‘turned off’. These elements are:\"]}],[\"$\",\"ul\",\"8\",{\"start\":\"$undefined\",\"className\":\"$undefined\",\"children\":[[\"$\",\"li\",\"0\",{\"className\":\"$undefined\",\"children\":[\"Air Conditioners\"]}],[\"$\",\"li\",\"1\",{\"className\":\"$undefined\",\"children\":[\"Air Purifiers\"]}],[\"$\",\"li\",\"2\",{\"className\":\"$undefined\",\"children\":[\"Lights\"]}]]}],[\"$\",\"p\",\"9\",{\"className\":\"$undefined\",\"children\":[\"The state of these elements is controlled by MQTT messages, which are published and subscribed to by the client application. The client application also publishes MQTT messages to control the state of these elements.\"]}],[\"$\",\"p\",\"10\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"img\",\"0\",{\"alt\":\"screenshot\",\"title\":\"$undefined\",\"src\":\"/project-images/virtual-smart-office/5.png\",\"className\":\"$undefined\"}]]}],[\"$\",\"h4\",\"11\",{\"id\":\"mqtt-controls\",\"className\":\"$undefined\",\"children\":[\"MQTT Controls\"]}],[\"$\",\"p\",\"12\",{\"className\":\"$undefined\",\"children\":[\"The client also displays a series of toggle switches. These provide a real-time, multi-pub/sub interface, whereby multiple clients can publish and subscribe to the MQTT messages being transmitted/received from/to the client.\"]}],[\"$\",\"blockquote\",\"13\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"p\",\"0\",{\"className\":\"$undefined\",\"children\":[\"The virtual Air Conditioners and Air Purifiers used in this simulation do not have an effect on the data generated in the graphs. Their only purpose is to simulate/showcase MQTT control over the building.\"]}]]}],[\"$\",\"h4\",\"14\",{\"id\":\"data-graphs\",\"className\":\"$undefined\",\"children\":[\"Data Graphs\"]}],[\"$\",\"p\",\"15\",{\"className\":\"$undefined\",\"children\":[\"The application also displays sensor telemetry from simulated IoT environmental quality sensors. The data from these ‘devices’ are generated by the \",[\"$\",\"strong\",\"1\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"$undefined\",\"children\":\"IEQ Simulator\"}]]}],\" service, which is explained below. The graph dashboard is embedded into this application and is generated using Grafana, which takes a data feed from InfluxDB.\"]}],[\"$\",\"h4\",\"16\",{\"id\":\"mobile-application\",\"className\":\"$undefined\",\"children\":[\"Mobile Application\"]}],[\"$\",\"p\",\"17\",{\"className\":\"$undefined\",\"children\":[\"There is a mobile application as well, which is accessible via the QR code on the client application (\",[\"$\",\"a\",\"2\",{\"href\":\"https://iot-sim-controller.grahamcoulby.co.uk/\",\"title\":\"$undefined\",\"className\":\"$undefined\",\"children\":[\"https://iot-sim-controller.grahamcoulby.co.uk/\"]}],\"). The mobile application is actually the same React application, but with a different UI. The docker-compose file uses the same build command as the client application:\"]}],[\"$\",\"pre\",\"18\",{\"className\":\"$undefined\",\"children\":[\"$\",\"code\",null,{\"className\":\"lang-docker\",\"children\":\"build: ./client/\"}]}],[\"$\",\"p\",\"19\",{\"className\":\"$undefined\",\"children\":[\"However, the mobile application sets the following flag in the environment variables:\"]}],[\"$\",\"pre\",\"20\",{\"className\":\"$undefined\",\"children\":[\"$\",\"code\",null,{\"className\":\"lang-bash\",\"children\":\"REACT_APP_MOBILE=true\"}]}],[\"$\",\"p\",\"21\",{\"className\":\"$undefined\",\"children\":[\"When the React app sees this flag, it shows only the toggle switches and the connect buttons, this saved writing two separate implementations of the application - but also allows the main application to be scalable to different screen sizes - without limiting the functionality of the application.\"]}],[\"$\",\"p\",\"22\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"img\",\"0\",{\"alt\":\"screenshot\",\"title\":\"$undefined\",\"src\":\"/project-images/virtual-smart-office/3.png\",\"className\":\"$undefined\"}]]}],[\"$\",\"hr\",\"23\",{\"className\":\"$undefined\"}],[\"$\",\"h3\",\"24\",{\"id\":\"ieq-predictor-api\",\"className\":\"$undefined\",\"children\":[\"IEQ Predictor API\"]}],[\"$\",\"p\",\"25\",{\"className\":\"$undefined\",\"children\":[\"An IEQ predictor API was created to generate realistic 'fake' sensor data. The data are generated using an \",[\"$\",\"strong\",\"1\",{\"className\":\"$undefined\",\"children\":[\"Autoregressive Long Short Term Memory Neural Network,\"]}],\" which is trained on IEQ data captured from a previous study entitled “Personalised and Sustainable IEQ Monitoring: Use of Multi-Modal and Pervasive Technologies” (\",[\"$\",\"a\",\"5\",{\"href\":\"https://doi.org/10.3390/ijerph20064897\",\"title\":\"$undefined\",\"className\":\"$undefined\",\"children\":[\"https://doi.org/10.3390/ijerph20064897\"]}],\"). The data were captured from a series of sensors placed in a physical study location. The data were captured over a period of 6 months, and the data were captured at 1-minute intervals. Data were captured from the following sensors:\"]}],[\"$\",\"ul\",\"26\",{\"start\":\"$undefined\",\"className\":\"$undefined\",\"children\":[[\"$\",\"li\",\"0\",{\"className\":\"$undefined\",\"children\":[\"CO2 Sensor\"]}],[\"$\",\"li\",\"1\",{\"className\":\"$undefined\",\"children\":[\"eCO2 Sensor\"]}],[\"$\",\"li\",\"2\",{\"className\":\"$undefined\",\"children\":[\"Temperature Sensor\"]}],[\"$\",\"li\",\"3\",{\"className\":\"$undefined\",\"children\":[\"Humidity Sensor\"]}],[\"$\",\"li\",\"4\",{\"className\":\"$undefined\",\"children\":[\"Light Sensor\"]}],[\"$\",\"li\",\"5\",{\"className\":\"$undefined\",\"children\":[\"Sound Sensor\"]}],[\"$\",\"li\",\"6\",{\"className\":\"$undefined\",\"children\":[\"Pressure Sensor\"]}]]}],[\"$\",\"p\",\"27\",{\"className\":\"$undefined\",\"children\":[\"The LSTM model was trained to generate a new sensor reading for each of the sensors based on the previous 10 readings. The model was trained on 70% of the data, and the remaining 30% was used to validated and test the model. The model was trained using the Keras library, and the model was saved as a .h5 file. The model was then integrated into a FastAPI application, which provides data to the \",[\"$\",\"strong\",\"6\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"$undefined\",\"children\":\"IEQ Simulator\"}]]}],\" service. The documentation for the API can be found here: \",[\"$\",\"a\",\"9\",{\"href\":\"https://ieq-predict.grahamcoulby.co.uk/docs\",\"title\":\"$undefined\",\"className\":\"$undefined\",\"children\":[\"https://ieq-predict.grahamcoulby.co.uk/docs\"]}]]}],[\"$\",\"p\",\"28\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"img\",\"0\",{\"alt\":\"screenshot\",\"title\":\"$undefined\",\"src\":\"/project-images/virtual-smart-office/1.png\",\"className\":\"$undefined\"}]]}],[\"$\",\"h3\",\"29\",{\"id\":\"iot-simulator-service\",\"className\":\"$undefined\",\"children\":[\"IoT Simulator Service\"]}],[\"$\",\"p\",\"30\",{\"className\":\"$undefined\",\"children\":[\"The IoT Simulator service is a python application that generates simulated data from a series of IoT devices. The application calls the \",[\"$\",\"strong\",\"1\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"$undefined\",\"children\":\"IEQ Predictor\"}]]}],\" API to generate the data for the sensors. Since the \",[\"$\",\"strong\",\"3\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"$undefined\",\"children\":\"IEQ Predictor\"}]]}],\" service requires the previous 10 readings to generate a new reading, the IoT Simulator service creates the payload for the API by taking a sample from the original dataset used to train the model.\"]}],[\"$\",\"p\",\"31\",{\"className\":\"$undefined\",\"children\":[\"To create the data the following method is used:\"]}],[\"$\",\"pre\",\"32\",{\"className\":\"$undefined\",\"children\":[\"$\",\"code\",null,{\"className\":\"lang-python\",\"children\":\"\\ndef build_df(room, dayOffset=0):\\n    \\\"\\\"\\\"Builds the df from the ImputationResult.csv file. This file contains\\n    the imputed data from a previous study (https://doi.org/10.3390/ijerph20064897)\\n    and is used to train the model. The df is built by reading the CSV file\\n    and adjusting the timestamps to the current time. This is done by finding the\\n    last record in the df with the same day, hour and minute as the current\\n    timestamp. The df is then sliced from the start to the index of the last\\n    record. The date is then shifted by the number of days between the last record\\n    and the current timestamp. This creates a df that is simulating the current\\n    historical data.\\n    \\\"\\\"\\\"\\n    global dfs\\n    # Read in the CSV data\\n    df = pd.read_csv(f\\\"{BASE_PATH}/ImputationResult.csv\\\")\\n\\n    df[\\\"dt\\\"] = pd.to_datetime(df.pop(\\\"dt\\\"), format=\\\"%Y-%m-%d %H:%M:%S\\\")\\n\\n    # Get current time\\n    now = datetime.now(pytz.timezone(\\\"Europe/London\\\"))\\n    hour = now.hour\\n    minute = now.minute\\n    weekday = now.weekday() + 1 - dayOffset\\n    if weekday \u003c= 0:\\n        weekday = 7\\n    elif weekday \u003e 7:\\n        weekday = 1\\n\\n    # Get the last index from the df where the Day, Hour and Minute\\n    # match the current timestamp\\n    idx = np.where(\\n        df[\\\"DayNumber\\\"].eq(weekday) \u0026 df[\\\"Hour\\\"].eq(hour) \u0026 df[\\\"Minute\\\"].eq(minute + 1)\\n    )[0][-1]\\n\\n    # Set the dateframe to a slice from start to the previously found index\\n    df = df[:idx]\\n\\n    # find the datetime in the lastrow and use it to find the number of days\\n    # that have passed between that datapoint and the current timestamp\\n    lastRow = df.iloc[-1]\\n    oldDateStr = f\\\"{lastRow['dt']} {lastRow['Hour']}:{lastRow['Minute']}\\\"\\n    oldTimestamp = parse(oldDateStr)\\n\\n    # store the number of days to offset for later\\n    dayOffset = (datetime.now() - oldTimestamp).days\\n\\n    # Shift the date by the dayOffset\\n    df[\\\"shifted_dt\\\"] = df.dt + pd.Timedelta(days=dayOffset)\\n\\n    # Convert the shifted_dt to a datetime dataframe\\n    date_time = pd.to_datetime(df[\\\"shifted_dt\\\"], format=\\\"%Y-%M-%D %H:%M:%S\\\")\\n\\n    dayInMins = 24 * 60\\n\\n    timestamp_s = date_time.map(pd.Timestamp.timestamp)\\n    df[\\\"timestamp_s\\\"] = timestamp_s\\n    df[\\\"Day sin\\\"] = np.sin(timestamp_s * (2 * np.pi / dayInMins))\\n    df[\\\"Day cos\\\"] = np.cos(timestamp_s * (2 * np.pi / dayInMins))\\n\\n    # Filter the df to only include the columns we need for the model\\n    dfs[room] = df[LABELS].tail(10)\"}]}],[\"$\",\"p\",\"33\",{\"className\":\"$undefined\",\"children\":[\"Essentially this method takes the original dataset, and finds the last record that matches the current day, hour and minute. It then slices the dataset from the start to the index of the last record. The date is then shifted by the number of days between the last record and the current timestamp. This creates a df that is simulating the current historical data. The df is later converted to a numpy array and is then passed to the \",[\"$\",\"strong\",\"3\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"$undefined\",\"children\":\"IEQ Predictor\"}]]}],\" API, which generates a new reading for each of the sensors. The data is then published to InfluxDB, which is then visualised in Grafana.\"]}],[\"$\",\"h3\",\"34\",{\"id\":\"mqtt\",\"className\":\"$undefined\",\"children\":[\"MQTT\"]}],[\"$\",\"p\",\"35\",{\"className\":\"$undefined\",\"children\":[\"I had originally developed (and actually have) a working stack that uses a local Mosquitto MQTT broker. However, since the client application is hosted behind an SSL certificate, I was unable to connect to the local broker. I had tried to use a reverse proxy to connect to the local broker, but this was conflicting with the CloudFlare tunnels I setup for this application. I then decided to use a public MQTT broker for the purposes of testing, which would allow me to connect to the broker from via a secure websocker from the client application. I used the EMQX broker, which is a public broker that allows you to create a free account. The client application connects to the broker using the Paho MQTT library, and the client subscribes to the following topics:\"]}],[\"$\",\"table\",\"36\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"thead\",null,{\"className\":\"$undefined\",\"children\":[\"$\",\"tr\",null,{\"className\":\"$undefined\",\"children\":[[\"$\",\"th\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"ParentTopic\"]}],[\"$\",\"th\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Room\"]}],[\"$\",\"th\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Sensor\"]}],[\"$\",\"th\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Topic\"]}]]}]}],[\"$\",\"tbody\",null,{\"className\":\"$undefined\",\"children\":[[\"$\",\"tr\",\"0\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"CO2\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/BoardRoom/CO2\"]}]]}],[\"$\",\"tr\",\"1\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"eCO2\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/BoardRoom/eCO2\"]}]]}],[\"$\",\"tr\",\"2\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Temperature\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/BoardRoom/Temperature\"]}]]}],[\"$\",\"tr\",\"3\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Humidity\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/BoardRoom/Humidity\"]}]]}],[\"$\",\"tr\",\"4\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Light\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/BoardRoom/Light\"]}]]}],[\"$\",\"tr\",\"5\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Sound\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/BoardRoom/Sound\"]}]]}],[\"$\",\"tr\",\"6\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Pressure\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/BoardRoom/Pressure\"]}]]}],[\"$\",\"tr\",\"7\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"OpenPlanOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"CO2\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/OpenPlanOffice/CO2\"]}]]}],[\"$\",\"tr\",\"8\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"OpenPlanOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"eCO2\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/OpenPlanOffice/eCO2\"]}]]}],[\"$\",\"tr\",\"9\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"OpenPlanOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Temperature\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/OpenPlanOffice/Temperature\"]}]]}],[\"$\",\"tr\",\"10\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"OpenPlanOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Humidity\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/OpenPlanOffice/Humidity\"]}]]}],[\"$\",\"tr\",\"11\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"OpenPlanOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Light\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/OpenPlanOffice/Light\"]}]]}],[\"$\",\"tr\",\"12\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"OpenPlanOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Sound\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/OpenPlanOffice/Sound\"]}]]}],[\"$\",\"tr\",\"13\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"OpenPlanOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Pressure\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/OpenPlanOffice/Pressure\"]}]]}],[\"$\",\"tr\",\"14\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"MultiOccupantOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"CO2\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/MultiOccupantOffice/CO2\"]}]]}],[\"$\",\"tr\",\"15\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"MultiOccupantOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"eCO2\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/MultiOccupantOffice/eCO2\"]}]]}],[\"$\",\"tr\",\"16\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"MultiOccupantOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Temperature\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/MultiOccupantOffice/Temperature\"]}]]}],[\"$\",\"tr\",\"17\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"MultiOccupantOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Humidity\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/MultiOccupantOffice/Humidity\"]}]]}],[\"$\",\"tr\",\"18\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"MultiOccupantOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Light\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/MultiOccupantOffice/Light\"]}]]}],[\"$\",\"tr\",\"19\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"MultiOccupantOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Sound\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/MultiOccupantOffice/Sound\"]}]]}],[\"$\",\"tr\",\"20\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"MultiOccupantOffice\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Pressure\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"VirtualSmartOffice/MultiOccupantOffice/Pressure\"]}]]}]]}]]}],[\"$\",\"p\",\"37\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"img\",\"0\",{\"alt\":\"screenshot\",\"title\":\"$undefined\",\"src\":\"/project-images/virtual-smart-office/6.png\",\"className\":\"$undefined\"}]]}],[\"$\",\"h3\",\"38\",{\"id\":\"timeseries-database-influxdb\",\"className\":\"$undefined\",\"children\":[\"Timeseries Database (InfluxDB)\"]}],[\"$\",\"p\",\"39\",{\"className\":\"$undefined\",\"children\":[\"I chose to use InfluxDB because it is a time series database, which is ideal for storing the sensor data. The data is stored in the following format:\"]}],[\"$\",\"table\",\"40\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"thead\",null,{\"className\":\"$undefined\",\"children\":[\"$\",\"tr\",null,{\"className\":\"$undefined\",\"children\":[[\"$\",\"th\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Time\"]}],[\"$\",\"th\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Room\"]}],[\"$\",\"th\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Sensor\"]}],[\"$\",\"th\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Value\"]}]]}]}],[\"$\",\"tbody\",null,{\"className\":\"$undefined\",\"children\":[[\"$\",\"tr\",\"0\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"2021-05-01T00:00:00Z\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"CO2\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"400\"]}]]}],[\"$\",\"tr\",\"1\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"2021-05-01T00:00:00Z\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"eCO2\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"400\"]}]]}],[\"$\",\"tr\",\"2\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"td\",\"0\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"2021-05-01T00:00:00Z\"]}],[\"$\",\"td\",\"1\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"BoardRoom\"]}],[\"$\",\"td\",\"2\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"Temperature\"]}],[\"$\",\"td\",\"3\",{\"style\":{},\"className\":\"$undefined\",\"children\":[\"20\"]}]]}]]}]]}],[\"$\",\"p\",\"41\",{\"className\":\"$undefined\",\"children\":[\"the data is then visualised in Grafana. Timeseries databases are ideal for storing data that is generated over time, and is often used for IoT applications. InfluxDB is also very easy to setup and use, and has a very good integration with Grafana.\"]}],[\"$\",\"p\",\"42\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"img\",\"0\",{\"alt\":\"screenshot\",\"title\":\"$undefined\",\"src\":\"/project-images/virtual-smart-office/4.png\",\"className\":\"$undefined\"}]]}],[\"$\",\"h3\",\"43\",{\"id\":\"data-visualisations-grafana\",\"className\":\"$undefined\",\"children\":[\"Data Visualisations (Grafana)\"]}],[\"$\",\"p\",\"44\",{\"className\":\"$undefined\",\"children\":[\"Grafana was chosen because its has a very good integration with InfluxDB, and it is very easy to setup and use. Grafana is a data visualisation tool that allows you to create dashboards that can be used to visualise data from a variety of sources. Grafana is also very easy to setup and use, and has a very good integration with InfluxDB. The dashboards can be made public, which allows them to be embedded into external applications with ease... So long as the following environment variables are setup when the container is created:\"]}],[\"$\",\"pre\",\"45\",{\"className\":\"$undefined\",\"children\":[\"$\",\"code\",null,{\"className\":\"lang-bash\",\"children\":\"- GF_SECURITY_ALLOW_EMBEDDING=true\\n- GF_FEATURE_TOGGLES_ENABLE=publicDashboards\"}]}],[\"$\",\"p\",\"46\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"img\",\"0\",{\"alt\":\"screenshot\",\"title\":\"$undefined\",\"src\":\"/project-images/virtual-smart-office/2.png\",\"className\":\"$undefined\"}]]}],[\"$\",\"h3\",\"47\",{\"id\":\"docker-and-docker-compose\",\"className\":\"$undefined\",\"children\":[\"Docker and Docker Compose\"]}],[\"$\",\"p\",\"48\",{\"className\":\"$undefined\",\"children\":[\"Each service within this stack is containerised using Docker and brought online using \",[\"$\",\"code\",\"1\",{\"className\":\"$undefined\",\"children\":\"docker-compose\"}],\". Wherever possible I try to use Docker Compose over vanilla Docker because it is much easier to manage multiple containers using a single \",[\"$\",\"code\",\"3\",{\"className\":\"$undefined\",\"children\":\"docker-compose.yml\"}],\" file and the files are both easier to understand and give you a persistent record of the configuration of the stack.\"]}],[\"$\",\"h3\",\"49\",{\"id\":\"cloudflare\",\"className\":\"$undefined\",\"children\":[\"CloudFlare\"]}],[\"$\",\"p\",\"50\",{\"className\":\"$undefined\",\"children\":[\"I migrated to CloudFlare as my domain provide about a year ago as I was using the service for caching and traffic monitoring. For this project I setup tunnels to provide DNS records for services running on \",[\"$\",\"strong\",\"1\",{\"className\":\"$undefined\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"$undefined\",\"children\":\"Oracle Cloud Infrastructure\"}]]}],\". I also used CloudFlare to generate the SSL certificates for those services.\"]}],[\"$\",\"h3\",\"51\",{\"id\":\"oracle-cloud-infrastructure\",\"className\":\"$undefined\",\"children\":[\"Oracle Cloud Infrastructure\"]}],[\"$\",\"p\",\"52\",{\"className\":\"$undefined\",\"children\":[\"I used Oracle Cloud Infrastructure to host all of the services in this stack. I chose to use Oracle Cloud Infrastructure because I was able to get a free ARM instance with 24GB of RAM and 4 vCPUs. Previously I have used this just for testing docker images, but I found that it was more than capable of running the entire stack, with plenty of room to spare. I was keen to use a cloud provider for this project as not only did I want it to be accessible from anywhere, I wanted the project to be realistic to typical IoT deployments, which would typically be hosted in the cloud.\"]}],[\"$\",\"h3\",\"53\",{\"id\":\"api\",\"className\":\"$undefined\",\"children\":[\"API\"]}],[\"$\",\"p\",\"54\",{\"className\":\"$undefined\",\"children\":[\"I intend to develop a second FastAPI service, which will be used to provide an API for the InfluxDB database. This will provide a persistent API for capturing simulated sensor data for testing and development purposes. This will be developed in a separate repository.\"]}],[\"$\",\"hr\",\"55\",{\"className\":\"$undefined\"}],[\"$\",\"p\",\"56\",{\"className\":\"$undefined\",\"children\":[\"Try the Client App:\"]}],[\"$\",\"a\",\"57\",{\"className\":\"btn btn-dark\",\"href\":\"https://iot-sim.grahamcoulby.co.uk/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[[\"$\",\"i\",\"0\",{\"className\":\"fa fa-globe\",\"children\":[]}],\" Try the Client App\\n\"]}],[\"$\",\"p\",\"58\",{\"className\":\"$undefined\",\"children\":[\"Try the Mobile Controller:\"]}],[\"$\",\"a\",\"59\",{\"className\":\"btn btn-dark\",\"href\":\"https://iot-sim-controller.grahamcoulby.co.uk/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[[\"$\",\"i\",\"0\",{\"className\":\"fa fa-globe\",\"children\":[]}],\" Try the Mobile Controller\\n\"]}],[\"$\",\"p\",\"60\",{\"className\":\"$undefined\",\"children\":[\"View the Dashboard:\"]}],[\"$\",\"a\",\"61\",{\"className\":\"btn btn-dark\",\"href\":\"https://grafana.grahamcoulby.co.uk/public-dashboards/15c1218cf7744fb6969bbd9bd26ce287?orgId=1\u0026refresh=10s\u0026kiosk\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[[\"$\",\"i\",\"0\",{\"className\":\"fa fa-globe\",\"children\":[]}],\" View the Dashboard\\n\"]}],[\"$\",\"p\",\"62\",{\"className\":\"$undefined\",\"children\":[\"Read the API Docs:\"]}],[\"$\",\"a\",\"63\",{\"className\":\"btn btn-dark\",\"href\":\"https://ieq-predict.grahamcoulby.co.uk/docs\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[[\"$\",\"i\",\"0\",{\"className\":\"fa fa-globe\",\"children\":[]}],\" Read the API Docs\\n\"]}]]}]}]]}]}]]}]}],null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"virtual-smart-office\\\"}\"},\"styles\":[]}],\"segment\":[\"slug\",\"virtual-smart-office\",\"d\"]},\"styles\":[]}],\"segment\":\"portfolio\"},\"styles\":[]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"8:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Graham Coulby\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Home page for Graham Coulby\"}],[\"$\",\"link\",\"3\",{\"rel\":\"manifest\",\"href\":\"/img/site.webmanifest\"}],[\"$\",\"meta\",\"4\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=0.85\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Graham Coulby\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"Graham Coulby is a post-doc computer scientist who is interested in reserarch, IoT, embedded systems and full-stack development.\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:url\",\"content\":\"http://grahamcoulby.co.uk/\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:locale\",\"content\":\"en_GB\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:title\",\"content\":\"Graham Coulby\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:description\",\"content\":\"Graham Coulby is a post-doc computer scientist who is interested in reserarch, IoT, embedded systems and full-stack development.\"}],[\"$\",\"link\",\"13\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}],[\"$\",\"link\",\"14\",{\"rel\":\"icon\",\"href\":\"/icon.png?8c419b8fdc4a0f79\",\"type\":\"image/png\",\"sizes\":\"32x32\"}],[\"$\",\"link\",\"15\",{\"rel\":\"apple-touch-icon\",\"href\":\"/apple-icon.png?eda77df8ba9976b2\",\"type\":\"image/png\",\"sizes\":\"180x180\"}]]\n"])</script></body></html>